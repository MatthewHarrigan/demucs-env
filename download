#!/bin/bash
# Download audio from YouTube/URL to input folder

cd "$(dirname "$0")"

if [ -z "$1" ]; then
    echo "Usage: ./download <url>"
    echo ""
    echo "Examples:"
    echo "  ./download https://youtube.com/watch?v=..."
    echo "  ./download https://soundcloud.com/..."
    exit 1
fi

mkdir -p "$(pwd)/input" "$(pwd)/cache"

echo "Downloading: $1"
echo ""

docker run --rm \
    -v "$(pwd)/input:/audio/input" \
    -v "$(pwd)/cache:/root/.cache" \
    --entrypoint yt-dlp \
    demucs \
    -x --audio-format mp3 --audio-quality 0 \
    -o "input/%(title)s.%(ext)s" \
    "$1"

echo ""
echo "Files in input/:"
ls -1 input/*.mp3 2>/dev/null | xargs -I{} basename {}
